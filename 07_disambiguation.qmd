# Введение в `cg3`: разрешение морфологической неоднозначности

## Разрешение морфологической неоднозначности

...

Парадигма Constraint grammar (CG) [@karlsson1995; @bick15] --- это правиловая процедурная система обработки текста, позволяющая решать достаточно большой набор разнообразных задач, такие как

- разрешение неоднозначности;
- приписывание тэгов, например, синтаксических ролей;
- разрешение анафоры;
- построение деревьев зависимостей;
- и многие другие.

Отмечу неожиданное преимущество правиловых фреймворков: их достаточно легко превращать в текст, объясняющий процедуру. Для правил CG была сделана такая попытка в работе [@swanson25].

## `cg3`

В наших лекциях для разрешения морфологической неоднозначности мы будем использовать `cg3` (полное название `vislcg3`). `VISL` (Visual Interactive Syntax Learning) --- подпроект датской компании GrammarSoft ApS, а `CG3` обозначает новую, третью, версию реализации парадигмы. Чтобы установить достаточно следующих команд.

```{{shell}}
$ curl -s https://apertium.projectjj.com/apt/install-nightly.sh | sudo bash
$ sudo apt-get install cg3
```

Первая команда добавляет в операционную систему новый источник программ, он такой же как и для команд `lexd` и `twol`. Вторая команда --- стандартный способ установить программу. У программы есть большая  [документация](https://edu.visl.dk/cg3/chunked/index.html), но начинается она со следующего предостережения:

>  This manual should be regarded as a guideline. Some of the features or functionality described is either not implemented yet, or does not work exactly as advertised. A good place to see what is and is not implemented is to run the regression test suite as the test names are indicative of features. The individual tests are also good starting points to find examples on how a specific feature works. 

### Первый пример

Рассмотрим такой трансдьюсер, записанный в `example.lexd`:

```{python}
!cat examples/07_example.lexd
```

Мы его можем скомпилировать в оптимизированный:

```{{shell}}
$ lexd example.lexd | hfst-txt2fst | hfst-invert | hfst-fst2fst -O -o analyzer.hfstol
```

```{python}
!lexd examples/07_example.lexd | hfst-txt2fst | hfst-invert | hfst-fst2fst -O -o examples/analyzer.hfstol
```

Подадим предложение на вход процессору:

```{{shell}}
$ echo "Поезд едет в город." | hfst-proc analyzer.hfstol
```

```{python}
!echo "Поезд едет в город." | hfst-proc examples/analyzer.hfstol
```

Апертиумовский формат неудобно читать, так что добавим флаг `-C`, чтобы `hfst-proc` преобразовал получившееся в CG формат:

```{{shell}}
$ echo "Поезд едет в город." | hfst-proc -C analyzer.hfstol
```

```{python}
!echo "Поезд едет в город." | hfst-proc -C examples/analyzer.hfstol
```

Мы видим, что форма *город* имеет два возможных разбора. Кроме того мы видим, что один из разборов точно неправильный. Для того чтобы убрать ненужный разбор, создадим следующий файл `cg_rules_1.rlx`:

```{python}
!cat examples/07_cg_rules_1.rlx
```

Применим написанное правило к нашему трансдьюсеру:

```{{shell}}
$ echo "Поезд едет в город." | hfst-proc -C analyzer.hfstol | cg3 -g cg_rules_1.rlx
```

```{python}
!echo "Поезд едет в город." | hfst-proc -C examples/analyzer.hfstol | cg3 -g examples/07_cg_rules_1.rlx
```

Таким образом мы избавились от ненужного разбора. В следующих разделах мы углубимся в возможности `cg3`.

### О программе

`cg3` --- это основная программа, которую мы будем использовать. Она по умолчанию угадывает формат, в котором ей поступают данные на вход и отдает в таком же формате. Однако есть и программы более узкого назначения:

- `cg-conv` --- программа для преобразования входных/выходных типов данных (например, между апертиумовским и CG);
- `cg-comp` компилирует файл CG правил в бинарный файл;
- `cg-proc` обрабатывает входные данные при помощи файла CG правил или его бинарного варианта;
- и некоторые другие.

В программе `cg3` достаточно много аргументов (см. `cg3 -h`), нам важно три:

- `-g` --- указывает файл с CG правилами;
- `-I` --- файл для чтения вместо стандартного stdin;
- `-O` --- файл для записи результата работы вместо стандартного stdout.

### Структура `.rlx` файла

Файлы с CG правилами принято записывать в файлы с расширениями `.rlx` или `.cg3`.

```{python}
!rm -f examples/*.hfstol
```
